"undefined"==typeof room&&(room={}),$(function(){function a(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function b(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)}room.utils={isMobile:a,isIOS:b}}),"undefined"==typeof room&&(room={}),$(function(){"use strict";function a(){return!document[c]}var b=function(){var a="hidden",b=["webkit","moz","ms"];if(a in document)return"";a="Hidden";for(var c=0;c<b.length;c++)if(b+a in document)return b;return""}(),c=b?b+"Hidden":"hidden",d=b+"visibilitychange",e={log:function(){}},f={maxRetry:5,authCommand:"room.auth",authError:null,retryInterval:1e3,watchInterval:60,noopCommand:"noop",logger:e};/iPhone|iPad|iPod/i.test(navigator.userAgent)&&(d="pageshow"),room.Connection=function(b){function e(a){if(t.log("request",a),!p())return void(A<b.maxRetry&&(n(function(){e(a)}),z||(D=q())));b.onRequest&&b.onRequest(a.command,a.data);var c=(new Date).getTime(),d=++u;v[d]=c,a.success&&(w[d]=a.success),a.error&&(x[d]=a.success);var f={id:d,command:a.command,data:a.data};return a.log&&(f.log=a.log),D.send(JSON.stringify(f)),s}function g(a,b,c){return b&&(w[a]=b),c&&(x[a]=c),s}function h(a){delete w[a],delete w[a]}function i(a){z=!1,t.log("onOpen",b.url),b.onOpen&&b.onOpen(a),A=0,b.authToken&&e({command:b.authCommand,data:b.authToken,success:function(a){b.authToken=a},error:b.authError});for(var c=0;c<y.length;c++)y[c]();y=[]}function j(a){t.log("receive",a.data);var c=JSON.parse(a.data),d=v[c.id],e=null;d&&delete v[c.id],b.onMessage&&b.onMessage(c,d),"error"==c.type?c.id&&x[c.id]?e=x[c.id]:c.command&&x[c.command]?e=x[c.command]:b.onServerError&&(e=b.onServerError):c.id&&w[c.id]?e=w[c.id]:c.command&&w[c.command]&&(e=w[c.command]),c.id&&(delete w[c.id],delete x[c.id]),e?e(c.data):"error"!=c.type&&t.log("UnknownMessage",a.data)}function k(a){t.log("close",b.url),b.onClose&&b.onClose(a),A<b.maxRetry&&(setTimeout(function(){p()||(D=q())},A*b.retryInterval),A++)}function l(a){b.onSocketError&&b.onSocketError(a)}function m(a,b){return setInterval(function(){p()&&e($.extend(!0,{},b))},a)}function n(a){p()?a():y.push(a)}function o(){p()&&(A=b.maxRetry,D.close()),C&&(clearInterval(C),C=0)}function p(){return 1==D.readyState}function q(){z=!0;var a=new WebSocket(b.url);return a.onopen=i,a.onmessage=j,a.onerror=l,a.onclose=k,a}function r(){var a=(new Date).getTime();t.log("watch",a-B+"ms"),B=a,!p()&&A<b.maxRetry&&(D=q())}"string"==typeof b&&(b={url:b}),b=$.extend({},f,b);var s=this,t=b.logger,u=0,v={},w={},x={},y=[],z=!1,A=0,B=(new Date).getTime(),C=setInterval(r,1e3*b.watchInterval),D=q();$(window).on("beforeunload",o),t.log("visibility",c,d),$(document).on(d,function(){var b=a();t.log(d,"visible="+b),b&&!p()&&(D=q())}),b.noopCommand&&g("noopCommand",function(){}),$.extend(this,{request:e,addEventListener:g,removeEventListener:h,on:g,off:h,polling:m,ready:n,close:o,isConnected:p,onOpen:function(a){return b.onOpen=a,this},onClose:function(a){return b.onClose=a,this},onRequest:function(a){return b.onRequest=a,this},onMessage:function(a){return b.onMessage=a,this},onSocketError:function(a){return b.onSocketError=a,this},onServerError:function(a){return b.onServerError=a,this}})}}),"undefined"==typeof room&&(room={}),$(function(){room.Cache=function(a,b){function c(c){if(a)try{return a.getItem(c)}catch(d){b&&console&&console.log(d)}return null}function d(a){var b=c(a);return b&&(b=JSON.parse(b)),b}function e(c,d){if(a){"object"==typeof d&&(d=JSON.stringify(d));try{a.setItem(c,d)}catch(e){b&&console&&console.log(e)}}}function f(c){if(a)try{a.removeItem(c)}catch(d){b&&console&&console.log(d)}}function g(){var c=[];if(a)try{for(var d=0;d<a.length;d++)c.push(a.key(d))}catch(e){b&&console&&console.log(e)}return c}function h(){try{return sotrage?a.length:0}catch(c){b&&console&&console.log(c)}}function i(){if(a)try{a.clear()}catch(c){b&&console&&console.log(c)}}$.extend(this,{get:c,getAsJson:d,put:e,remove:f,size:h,clear:i,keys:g})}}),"undefined"==typeof room&&(room={}),"undefined"==typeof room.logger&&(room.logger={}),$(function(){function a(b){var c=typeof b;if("object"!==c)return b;if($.isArray(b)){for(var d=[],e=0;e<b.length;e++)c=typeof b[e],d.push("function"===c?"(function)":"object"===c?a(b[e]):b[e]);return d}var f={};for(var g in b)c=typeof g,f[g]="function"===c?"(function)":"object"===c?a(b[g]):b[g];return f}room.logger.DivLogger=function(b){this.log=function(){for(var c=[],d=0;d<arguments.length;d++)c.push("object"==typeof arguments[d]?a(arguments[d]):arguments[d]);$("<p/>").text(JSON.stringify(c)).prependTo(b)}},room.logger.nullLogger={log:function(){}},room.logger.normalizeFunc=a});