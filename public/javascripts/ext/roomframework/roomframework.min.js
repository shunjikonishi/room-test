"undefined"==typeof room&&(room={}),$(function(){"use strict";var a={log:function(){}},b={maxRetry:5,authCommand:"room.auth",authError:null,retryInterval:1e3,watchInterval:60,logger:a};room.Connection=function(a){function c(b){if(q.log("request",b),!m())return void(x<a.maxRetry&&(k(function(){c(b)}),w||(A=n())));a.onRequest&&a.onRequest(b.command,b.data);var d=(new Date).getTime(),e=++r;s[e]=d,b.success&&(t[e]=b.success),b.error&&(u[e]=b.success);var f={id:e,command:b.command,data:b.data};return b.log&&(f.log=b.log),A.send(JSON.stringify(f)),p}function d(a,b,c){return b&&(t[a]=b),c&&(u[a]=c),p}function e(a){delete t[a],delete t[a]}function f(b){w=!1,q.log("onOpen",a.url),a.onOpen&&a.onOpen(b),x=0,a.authToken&&c({command:a.authCommand,data:a.authToken,success:function(b){a.authToken=b},error:a.authError});for(var d=0;d<v.length;d++)v[d]();v=[]}function g(b){q.log("receive",b.data);var c=JSON.parse(b.data),d=s[c.id],e=null;d&&delete s[c.id],a.onMessage&&a.onMessage(c,d),"error"==c.type?c.id&&u[c.id]?e=u[c.id]:c.command&&u[c.command]?e=u[c.command]:a.onServerError&&(e=a.onServerError):c.id&&t[c.id]?e=t[c.id]:c.command&&t[c.command]&&(e=t[c.command]),c.id&&(delete t[c.id],delete u[c.id]),e?e(c.data):"error"!=c.type&&q.log("UnknownMessage",b.data)}function h(b){q.log("close",a.url),a.onClose&&a.onClose(b),x<a.maxRetry&&(setTimeout(function(){m()||(A=n())},x*retryInterval),x++)}function i(b){a.onSocketError&&a.onSocketError(b)}function j(a,b){return setInterval(function(){m()&&c($.extend(!0,{},b))},a)}function k(a){m()?a():v.push(a)}function l(){m()&&(x=a.maxRetry,A.close()),z&&(clearInterval(z),z=0)}function m(){return 1==A.readyState}function n(){w=!0;var b=new WebSocket(a.url);return b.onopen=f,b.onmessage=g,b.onerror=i,b.onclose=h,b}function o(){var b=(new Date).getTime();q.log("watch",b-y+"ms"),y=b,!m()&&x<a.maxRetry&&(A=n())}"string"==typeof a&&(a={url:a}),a=$.extend({},b,a);var p=this,q=a.logger,r=0,s={},t={},u={},v=[],w=!1,x=0,y=(new Date).getTime(),z=setInterval(o,1e3*a.watchInterval),A=n();$(window).on("beforeunload",l),$.extend(this,{request:c,addEventListener:d,removeEventListener:e,on:d,off:e,polling:j,ready:k,close:l,isConnected:m,onOpen:function(b){return a.onOpen=b,this},onClose:function(b){return a.onClose=b,this},onRequest:function(b){return a.onRequest=b,this},onMessage:function(b){return a.onMessage=b,this},onSocketError:function(b){return a.onSocketError=b,this},onServerError:function(b){return a.onServerError=b,this}})}}),"undefined"==typeof room&&(room={}),$(function(){room.Cache=function(a,b){function c(c){if(a)try{return a.getItem(c)}catch(d){b&&console&&console.log(d)}return null}function d(a){var b=c(a);return b&&(b=JSON.parse(b)),b}function e(c,d){if(a){"object"==typeof d&&(d=JSON.stringify(d));try{a.setItem(c,d)}catch(e){b&&console&&console.log(e)}}}function f(c){if(a)try{a.removeItem(c)}catch(d){b&&console&&console.log(d)}}function g(){var c=[];if(a)try{for(var d=0;d<a.length;d++)c.push(a.key(d))}catch(e){b&&console&&console.log(e)}return c}function h(){try{return sotrage?a.length:0}catch(c){b&&console&&console.log(c)}}function i(){if(a)try{a.clear()}catch(c){b&&console&&console.log(c)}}$.extend(this,{get:c,getAsJson:d,put:e,remove:f,size:h,clear:i,keys:g})}}),"undefined"==typeof room&&(room={}),"undefined"==typeof room.logger&&(room.logger={}),$(function(){function a(b){var c=typeof b;if("object"!==c)return b;if($.isArray(b)){for(var d=[],e=0;e<b.length;e++)c=typeof b[e],d.push("function"===c?"(function)":"object"===c?a(b[e]):b[e]);return d}var f={};for(var g in b)c=typeof g,f[g]="function"===c?"(function)":"object"===c?a(b[g]):b[g];return f}room.logger.DivLogger=function(b){this.log=function(){for(var c=[],d=0;d<arguments.length;d++)c.push("object"==typeof arguments[d]?a(arguments[d]):arguments[d]);$("<p/>").text(JSON.stringify(c)).prependTo(b)}},room.logger.nullLogger={log:function(){}},room.logger.normalizeFunc=a});